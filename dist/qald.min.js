!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).QALDistance=t()}(this,(function(){"use strict";const e={qwerty:["qwertyuiop","asdfghjkl","zxcvbnm,."],azerty:["azertyuiop","qsdfghjklmù","wxcvbn.,"],"йцукен":["йцукенгшщзхъ","фывапролджэ","ячсмитьбю."]};return class{options={};constructor(e={}){this.options=Object.fromEntries(Object.entries({misspells:{},layout:"qwerty",comparer:{enabled:!0,tags:{addition:e=>`<u>${e}</u>`,deletion:!1,replacement:e=>`<u>${e}</u>`}}}).map((([t,n])=>t in e?[t,e[t]]:[t,n])))}compute(e,t){const n=e.toLowerCase(),o=t.toLowerCase();if(!n.length)return o.length;if(!o.length)return n.length;const s=[];for(let e=0;e<=o.length;e++){s[e]=[e];for(let t=1;t<=n.length;t++)s[e][t]=0===e?t:Math.min(s[e-1][t]+1,s[e][t-1]+1,s[e-1][t-1]+(n[t-1]===o[e-1]?0:1))}let i=s[o.length][n.length];const r={};let c=o.length,l=n.length;const a=(e=-1,t=-1)=>{c+=e,l+=t},p=(e,t,n)=>{const o={"+":"insertion","-":"deletion","#":"replacement",U:"unchanged"},s=t-1;s in r==!1?r[s]={chars:[n],type:e in o?o[e]:"unknown"}:r[s].chars.splice(0,0,n)};for(;c+l>0;){const{a:e,b:t,c:r,d:h}={a:c>0&&l>0?s[c-1][l-1]:0,b:c>0&&l>=0?s[c-1][l]:0,c:l>0&&c>=0?s[c][l-1]:0,d:l>=0&&c>=0?s[c][l]:0};r<h&&0!=l&&0!=c?(p("-",l,n[l-1]),a(0)):t<h?(p("+",l,o[c-1]),a(-1,0)):e<h?(i+=this.distanceBetweenKeys(n[l-1],o[c-1])-1,p("#",l,o[c-1]),a()):a()}let h=Object.keys(r).sort(((e,t)=>t-e));const f={distance:i,changes:r};if(this.options.comparer.enabled){let t=e.split("");for(let e of h){const{chars:n,type:o}=r[e],s="function"==typeof this.options.comparer.tags[o],i=e=>this.options.comparer.tags[o](e.join(""));switch(o){case"insertion":s&&t.splice(parseInt(e)+1,0,i(n));break;case"deletion":case"replacement":s?t[e]=i(n):delete t[e]}}f.comparison=t.join("")}return f}getKeyPosition(t){const n=e[this.options.layout];for(let e in n)if(n[e].includes(t))return{row:e,col:n[e].indexOf(t)};return!1}distanceBetweenKeys(e,t){const n=this.options.misspells;if(e in n&&n[e]==t)return 1;const o=this.getKeyPosition(e),s=this.getKeyPosition(t);if(!1===o||!1===s)return 1;const i=Math.abs(o.col-s.col),r=Math.abs(o.row-s.row);return 1==i&&1==r?1:i+Math.pow(r,2)}}}));
